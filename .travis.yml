language: java
sudo: required
services:
  - docker
env:
  global:
  - IMAGE_NAME=ruijtendaal/iprwc-api
  - DB_USER=iprwc
  - secure: kCukA1Yd8qkml6sHdZ3leZsQ4ydj4PuADPFLyoKsJND4x15DHK1oneavczBGTI6L7NcFGIyszDrnSXPNiMVLRR+vaEnQbdtyMX+cMGHKjhtuwhEzCZjde3mvLuxK6uzbEnvJ7LXxJBGwb2L3HBhz2FPx6/UxKJHLXz/oT7BvT5rjhbHOkJEUqWPNXalAU0mBwBEpaVCBDuVQbk4rCnoIQ0YNftBhwamrWk8ISRTOKY0IgbwvozzPs7+p0iLX+GbelJgyJuNBCSDHme9DCg6YWSs9Bjv3inpG+DkiTSbMEu7MG3Z/IOIASSelL3DAUlYhfWfeQ6GT8+fgZ3qXoHjJEpuG26/5s31OeS2AXprFQ89roEbxmMga8vLCB5vA7BA+CBNYJjs4FUzMX2dGhYwY7bpuyYX4sZpc+qnWhdY53s4Ac32Eju+JyWCBv82fatzJ793VUlecFTGeDHLVevr5vpA7WQPthg3Kui8wmQS/o0v4vLUaqP53S6aAeb/Y7GriAgNf6rpGviwMQBX12cbTw10D1WCQl7gGKJnp7cJiEXtDd0HWbWadNvcfFLNo1hMiHK8PoNiHepE3OhyffbjiCRMByCs7B+YbYkWKHva8Oikfihw/jGstFmFYYDxuHvrOxct810S+y+x9a1nMjwAOsBCNwh+T1pXgCcV5iDdcXsQ=
  - secure: BYdGTBWwPkaJWbYVqKr8a3yMZL6PedzmZBRjkZBArMAxq1+PYamDYbjgOpO/Z2Yr/7Qm5uZ4/81c8bjZrNte3asE23bIpWh/yLdzVSWqZ3YJQ/+AJfL7B04sRpcVsxbPgpc1hYQwIR/cSURZyQwmtaAQ2L6ek3IO+QhSgU5jgr9ifEpyUDCbQUyXhrr6s/PhjYxCWa9EeG4EhDNuRDQiLFGixXX/5zwdg1R0x8BAEd737asqklALJyRjAHC0D3WhtiFBzc4pTKGPp9Ue9blOZcOCRl/2t6HkMC7bez3jSCWHNLzlg/PZlWpiXMeKFX6DxPQdKWtv7uMks+tpkp0okIYu5escWVuTs/Wl5E4GE5N8lQW84iFkRHCPXDdWN4+htEcQ1UQV0COTwzcTlCoMT/lTGsFans8yNSzaWWyunACNEkaborEn8jvWHqooBBIZY1go+g+5Hg2C/bN6ARXzVLaXcC97Zu8099N5GG5cE/iHlLdJYjbaMKjjHmustimdWRz4QGLLyk9vHTHhnO1xl3I1xTJEK41+W/nZCzOZasiJJGcd976IiSAlWiXwsirmCeTDPgoER6B9BAkJq9MabgCBQh+SOZTUp5zyZ+OxbffaxzPdRTKuGkjnHIUby1+fz3JIdi748LowGUyu+dnFbv+XwLIdnBtK5VlEhw/+ZUg=
  - secure: OvYtym2FBbtSv6+H6AuvHsCTSB+f5KwDdsNweMOs519++cHSLWNMtu4m0BHwZkMJS8SuytwTXb1Jivjfm+EqNWc6o8dPCRFopo+P/WQX9UBiA6QV5cvwdRUBw4nC8T4NMNyM9a3+gCSm7FqHXybaKMjVig0lEEf7dUDGRJhw5CExIh1h81bdq+9mEooznggcHuKBFG7f17dRw0ebQejOP4F2nncXKLmsltbH+Q9H96gS1RlgR42epCB74n+fToCc02HzsDbXjbk/F1UGdwT+B1nOWIxoNG51Hza8cv8k4gkCvBQvOAmxInPrnrB31GN4kBi/ET+1E5ZIb/96SNQoQ8Vz2zdMFit2mHvCqqEVzeaE5YBzF4e9gw+r8yA24KVIn+z7e5rQ/Y+rsklgT74FAVr176hicCQMIpw/s+5b9HInPSWbagU+sjhu29JW/8bnRWn0JX45RarAlEBfwZ/lxMN7JMetWLXYtDA6OkOj29xBc+oLOnSOe6SUMpZEwhSCN9FploUBN8WJ6ckWm+nKkViWX4htR2koKzCxpngoJCbRf2w4gWXfj1vrqtDpwIWcjwc/rC4KRY3MjDf2YkFam+/KHOxykRQ6sZxpOkjlsVgS+KgMGCvCvs/29HxZGWL4dhkLM2F6+NhpZI9Tkleg5LRrrQJT7pXv7y+6tbjunR0=
  - secure: AxgR7tImSV+L0cWpEnTU0q1vkiyr6O+jmBR8dNs9E528qKtg1krGzfQusi9UXWQZvqVsMp/am+R+GD/5qCteEbuIM9he8s5261Cwh6p7JaFM2qgVkxc3VhwDjY6BoIaHQ4ukLc72ZlyBuEkVqPiz/0s3t1JeVOhxdwheArkspPpYh8XmOuY4PRgNZM9Gvbb213kfOTluE69V1oaA1mOhnphBv4Q+yswDMB1dDyqWGuR15U6/hL/ksaoCoOxuuq5BLzcKVll+xkxg4lYePGnfnb+6cxfR8+K3x0KR3M2E+GO5HTUsjS88ZvRgcZmHj9i4JUFji+spdMtwwUMQD95dCPEbAu6W0EHBJ+kOHvDvz4aLqWtNOb/TrdvO1ALW9dKJR5r7CJMJmsVmbqUdQMe7ux2049PKo6YufnDoBu1YBI9waYKPCs3Ny1kjZBU5uF1Frh1q8gsii1DqUtA2dsW4ImCEySwqtsBkHxYyqx43y/KjteLfdqFdqkrbUlZ8Nvs0OPN8H3x6qCAyRzD4cgsOdaTKMgCxXnYLFTqdk6kXbMyvhVBaWqiPYvHKTW0r9T35XNfSwtv6nwoBsdJqGnbVPlZZVPKSUCdb+SsT+RBfgXc4A71xp14LQ0lm37XaWZ903Gt9T3pU1u4q5VwjWzKM/yjO/ZM6A3+CqJRkGWPSAb8=

before_script:
  - version=$(mvn org.apache.maven.plugins:maven-help-plugin:2.1.1:evaluate "-Dexpression=project.version")
script:
  - docker build --tag "$IMAGE_NAME" .
before_deploy:
  - docker login -u "$REGISTRY_USER" -p "$REGISTRY_PASS"
deploy:
  provider: script
  script: docker push "${IMAGE_NAME}:latest && docker push "${IMAGE_NAME}:${version}
  on:
    branch: master
