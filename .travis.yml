language: java
sudo: required
services:
  - docker
env:
  global:
  - IMAGE_NAME=ruijtendaal/iprwc-api
  - secure: MvqbXKqeI1k2yKlZYEmh9/VoaZiQPdflHBq2FLBsZ7rHe/TlkjwTUP+gJQJrU0jMXIzLjuZtAtscaKgT/uri7OPWib+ZDmNSSbCz3os7Q7soMf6lNV749a2qTKp1X+nWWjE0Vrut4U5HmPrl+orPHSpZlQ+AQbHO8EQ1ICfkZ2u+rfJ9zkGVN1n8CGunfQ4qvUzoQ95YzlGl8IvJGzR8qfsLsLLq6cYEq7oRGL0uzWi94D2Os1F01PB7D3qoljfy95Cxo27uzzMTRKtn8ZKU2Al4et38NM4ztQ+88xk30ys4vukO+tVBm6IqMTuoAxcqcfVY6HUCxvfkS3VRwP7xLfITRXMzJk/JkEfRGc8qa3b+aOxqY0rHDZK31t95LjxwYFnGAsnHINIORnwflmAs/AfMHNou+Jg5oInnqrXMSLavCNvDFdE3QwXDlo0Y65TUl6biMBqU4Q18Cb9fkAlZcxjEYGk9QDHZAEtSTzSVkkVWKaKCX9McfUzRgmEkgbS8v7gIY89/ARqt/eGsZ03N7n+ZtvtvbQ1aJNWoozpzO628XAHNVIMwIS3s66k8furfGnefK6oKrhKIvPYkmQcu62axeD1KZoeghMAxIVdXr4vwtgjMS7g4lV3ZKvwgh3gxEftk/pyHUIRYjIzel3/PeKc8z55b0lhC3nJkESFLjLc=
  - secure: AxgR7tImSV+L0cWpEnTU0q1vkiyr6O+jmBR8dNs9E528qKtg1krGzfQusi9UXWQZvqVsMp/am+R+GD/5qCteEbuIM9he8s5261Cwh6p7JaFM2qgVkxc3VhwDjY6BoIaHQ4ukLc72ZlyBuEkVqPiz/0s3t1JeVOhxdwheArkspPpYh8XmOuY4PRgNZM9Gvbb213kfOTluE69V1oaA1mOhnphBv4Q+yswDMB1dDyqWGuR15U6/hL/ksaoCoOxuuq5BLzcKVll+xkxg4lYePGnfnb+6cxfR8+K3x0KR3M2E+GO5HTUsjS88ZvRgcZmHj9i4JUFji+spdMtwwUMQD95dCPEbAu6W0EHBJ+kOHvDvz4aLqWtNOb/TrdvO1ALW9dKJR5r7CJMJmsVmbqUdQMe7ux2049PKo6YufnDoBu1YBI9waYKPCs3Ny1kjZBU5uF1Frh1q8gsii1DqUtA2dsW4ImCEySwqtsBkHxYyqx43y/KjteLfdqFdqkrbUlZ8Nvs0OPN8H3x6qCAyRzD4cgsOdaTKMgCxXnYLFTqdk6kXbMyvhVBaWqiPYvHKTW0r9T35XNfSwtv6nwoBsdJqGnbVPlZZVPKSUCdb+SsT+RBfgXc4A71xp14LQ0lm37XaWZ903Gt9T3pU1u4q5VwjWzKM/yjO/ZM6A3+CqJRkGWPSAb8=

before_script:
  - version=$(mvn org.apache.maven.plugins:maven-help-plugin:2.1.1:evaluate "-Dexpression=project.version")
script:
  - docker build --tag "$IMAGE_NAME" .
before_deploy:
  - echo "$REGISTRY_PASS" | docker login -u "$REGISTRY_USER" --password-stdin
deploy:
  provider: script
  script: docker push "${IMAGE_NAME}:latest && docker push "${IMAGE_NAME}:${version}
  on:
    branch: master
